<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>名人語錄匯入工具（產生 quotes.json）</title>
    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans TC, PingFang TC, Microsoft JhengHei, sans-serif; padding: 16px; }
      h1 { margin-top: 0; }
      textarea { width: 100%; min-height: 220px; font-family: ui-monospace, SFMono-Regular, Consolas, monospace; }
      .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin: 8px 0; }
      input[type="file"] { padding: 6px; }
      button { padding: 8px 12px; border: 1px solid #bbb; background: #fff; border-radius: 8px; cursor: pointer; }
      .hint { color: #555; font-size: 13px; }
      .preview { max-height: 200px; overflow: auto; background: #f7f7f7; border: 1px solid #ddd; padding: 8px; }
    </style>
  </head>
  <body>
    <h1>名人語錄匯入工具</h1>
    <p class="hint" style="margin-top:-6px;color:#8a8a8a">
      提醒：目前主站顯示僅使用 <code>merged_verses_quotes.txt</code>（每 4 行一組）。本頁工具僅做資料整理備用，輸出檔不會被前端主流程讀取。
    </p>
    <p class="hint">支援 CSV/TSV：「text,author」兩欄或「text\tauthor」。每行一筆。請確保你有權使用這些語錄（公眾領域、CC0、CC BY 標註來源，或你自有版權）。</p>

    <div class="row">
      <input id="file" type="file" accept=".csv,.tsv,.txt,.json" />
      <button id="loadExample">載入示例</button>
      <button id="parseBtn">解析輸入</button>
      <button id="downloadBtn" disabled>下載 quotes.json</button>
      <a href="index.html">回首頁</a>
    </div>

    <textarea id="input" placeholder="例：\n以終為始\t史蒂芬·柯維\n成為別人生命中的祝福\t瑞克·沃倫\n...\n"></textarea>

    <h3>預覽（前 10 筆）</h3>
    <div id="preview" class="preview"></div>

    <script>
      const input = document.getElementById('input');
      const file = document.getElementById('file');
      const preview = document.getElementById('preview');
      const downloadBtn = document.getElementById('downloadBtn');

      function toJSONRecords(lines) {
        const out = [];
        for (const line of lines) {
          const s = line.trim();
          if (!s) continue;
          let text = '', author = '';
          if (s.includes('\t')) {
            const [t, a] = s.split('\t');
            text = (t || '').trim(); author = (a || '').trim();
          } else {
            const idx = s.indexOf(',');
            if (idx >= 0) {
              text = s.slice(0, idx).trim();
              author = s.slice(idx + 1).trim();
            } else {
              text = s; author = '';
            }
          }
          if (text) out.push({ text, author });
        }
        return out;
      }

      function parse() {
        let raw = input.value.trim();
        if (!raw) { alert('請先貼上或載入資料'); return; }
        let records = [];
        if (raw.startsWith('[')) {
          // JSON
          try { records = JSON.parse(raw); } catch { alert('JSON 格式錯誤'); return; }
        } else {
          const lines = raw.split(/\r?\n/);
          // 跳過可能的表頭
          if (/^text(\t|,)author/i.test(lines[0])) lines.shift();
          records = toJSONRecords(lines);
        }
        if (!Array.isArray(records) || !records.length) { alert('未解析到資料'); return; }
        preview.textContent = JSON.stringify(records.slice(0, 10), null, 2) + (records.length > 10 ? `\n...共 ${records.length} 筆` : '');
        downloadBtn.disabled = false;
        downloadBtn.onclick = () => {
          const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json;charset=utf-8' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'quotes.json';
          a.click();
        };
      }

      document.getElementById('parseBtn').addEventListener('click', parse);
      document.getElementById('loadExample').addEventListener('click', () => {
        input.value = '努力是成功唯一的捷徑\t馬雲\n信心是靈魂的勇氣\t奧古斯丁\n以終為始\t史蒂芬·柯維\n把你的工作當成使命\t英格瓦·坎普拉德\n真正的領導是服務\t羅伯特·K·格林里夫';
      });
      file.addEventListener('change', async () => {
        const f = file.files?.[0]; if (!f) return;
        const text = await f.text();
        input.value = text;
      });
    </script>
  </body>
  </html>
