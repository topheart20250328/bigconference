<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BIG大特會 | 掃描開始</title>
    <meta name="description" content="掃描 QR Code 顯示一條經文與一條名人語錄；同一支手機每次掃描都會顯示相同結果。" />
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --card: #111827; /* gray-900 */
        --muted: #94a3b8; /* slate-400 */
        --text: #e5e7eb; /* gray-200 */
        --accent: #22c55e; /* green-500 */
        --accent-2: #60a5fa; /* blue-400 */
      }
      * { box-sizing: border-box; }
      body {
        margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans TC, PingFang TC, Microsoft JhengHei, sans-serif;
        background: radial-gradient(1200px 600px at 50% -200px, #1f2937 0, var(--bg) 60%);
        color: var(--text);
        min-height: 100vh; display: grid; place-items: center; padding: 24px;
      }
      .container { width: 100%; max-width: 1200px; display: grid; gap: 24px; justify-items: center; padding: 2vh 2vw; }
      header { text-align: center; }
      h1 { margin: 0; font-size: clamp(36px, 5vw, 64px); letter-spacing: 0.02em; }
      .note { color: var(--muted); font-size: clamp(14px, 2.2vw, 20px); text-align: center; }
      #qrcode { width: clamp(260px, 42vmin, 560px); height: clamp(260px, 42vmin, 560px); display: grid; place-items: center; }
      .link { margin-top: 8px; }
      .link a { color: var(--accent-2); text-decoration: none; font-size: clamp(14px, 2vw, 18px); }
      .link a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>BIG大特會</h1>
      </header>
      <div id="qrcode"></div>
      <div class="note">請用手機掃描上方 QR</div>
      <div class="link" id="fallbackLink" style="display:none"></div>
    </div>
    <script>
      // Target URL for scanning
      const target = location.origin + location.pathname.replace(/index\.html?$/, '') + 'view.html';

      const box = document.getElementById('qrcode');
      const size = Math.min(box.clientWidth, box.clientHeight) || 320;

      // Primary method: Google Chart Image API (simple, quick)
      const img = new Image();
      img.alt = 'Scan QR to open';
      img.width = size; img.height = size;
      img.referrerPolicy = 'no-referrer';
      img.src = `https://chart.googleapis.com/chart?cht=qr&chs=${size}x${size}&chl=${encodeURIComponent(target)}&choe=UTF-8`;

      // Fallback: if image fails, dynamically load a QR generator and render locally
      img.onerror = () => {
        // dynamic load of a tiny QR generator (CDN); if this also fails, show a direct link
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js';
        script.onload = () => {
          try {
            box.innerHTML = '';
            // QRCode from qrcodejs
            // eslint-disable-next-line no-undef
            new QRCode(box, { text: target, width: size, height: size, correctLevel: QRCode.CorrectLevel.M });
          } catch (e) {
            showLink();
          }
        };
        script.onerror = showLink;
        document.head.appendChild(script);
      };

      function showLink() {
        try { box.innerHTML = ''; } catch {}
        const linkWrap = document.getElementById('fallbackLink');
        linkWrap.style.display = 'block';
        linkWrap.innerHTML = `若 QR 未顯示，請點此開啟：<a href="${target}">${target}</a>`;
      }

      box.appendChild(img);
    </script>
  </body>
  </html>
