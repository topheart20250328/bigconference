<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QR Code 列印</title>
    <style>
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans TC, PingFang TC, Microsoft JhengHei, sans-serif; padding: 24px; display: grid; place-items: center; gap: 16px; }
      .wrap { text-align: center; }
      #qrcode { width: 280px; height: 280px; margin: 12px auto; }
      .url { font-size: 12px; color: #444; word-break: break-all; max-width: 600px; margin: 0 auto; }
      .row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 10px; }
      input[type="text"] { width: min(680px, 90vw); padding: 8px 10px; border-radius: 8px; border: 1px solid #bbb; font-size: 14px; }
      button, a { padding: 8px 12px; border-radius: 8px; border: 1px solid #bbb; background: #fff; cursor: pointer; text-decoration: none; color: #111; }
      @media print { .actions { display: none; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>QR Code</h1>
      <div id="qrcode"></div>
      <div class="url" id="pageUrl"></div>
      <div class="row">
        <input id="targetUrl" type="text" placeholder="目標網址，例如：https://你的網域/Random%20Scripture/index.html" />
        <button id="genBtn">更新 QR</button>
      </div>
      <div class="row actions">
        <a href="index.html">回到首頁</a>
        <button id="printBtn">列印</button>
      </div>
    </div>

    <script>
      const LS_KEY = 'rs_qr_target_url_v1';
      const url = new URL(window.location.href);
      const defaultTarget = (url.protocol.startsWith('http'))
        ? (url.origin + url.pathname.replace(/qrcode\.html$/, 'index.html'))
        : '';

      const input = document.getElementById('targetUrl');
      const pageUrl = document.getElementById('pageUrl');
      const holder = document.getElementById('qrcode');

      function makeQR(src) {
        holder.innerHTML = '';
        const img = new Image();
        img.alt = 'Scan QR to open';
        img.width = 280; img.height = 280;
        img.src = `https://chart.googleapis.com/chart?cht=qr&chs=280x280&chl=${encodeURIComponent(src)}&choe=UTF-8`;
        holder.appendChild(img);
      }

      function applyTarget(target) {
        input.value = target;
        pageUrl.textContent = target || '請輸入可被手機存取的網址（http/https）。若目前是以檔案方式開啟，本機路徑無法被手機存取。';
        if (target) {
          localStorage.setItem(LS_KEY, target);
          makeQR(target);
        } else {
          holder.innerHTML = '';
        }
      }

      const saved = localStorage.getItem(LS_KEY);
      applyTarget(saved || defaultTarget);

      document.getElementById('genBtn').addEventListener('click', () => {
        const v = input.value.trim();
        applyTarget(v);
      });
      document.getElementById('printBtn').addEventListener('click', () => window.print());
    </script>
  </body>
  </html>
